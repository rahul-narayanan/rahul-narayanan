const query = `
      SELECT
        JSON_OBJECT(
          'clientsList', JSON_ARRAYAGG(
            JSON_OBJECT(
              'client_id', c.client_id,
              'client_name', c.client_name,
              'is_company_admin', ucm.is_company_admin
            )
          ),
          'products', JSON_ARRAYAGG(e.product_name),
          'productRoles', ( -- Logic for productRoles
            SELECT
              JSON_OBJECTAGG(
                pr.product_role_name,
                JSON_ARRAYAGG(da.data_asset_view_name)
              )
            FROM user_entitlement ue
            LEFT JOIN product_role pr ON ue.product_role_id = pr.product_role_id
            LEFT JOIN data_asset da ON pr.product_role_id = da.product_role_id
            WHERE ue.user_id = :userId
          ),
          'clientsData', ( -- Logic for clientsData
            SELECT
              JSON_OBJECTAGG(
                c.client_id,
                JSON_OBJECT(
                  'client_name', c.client_name,
                  'is_company_admin', ucm.is_company_admin,
                  'products', JSON_ARRAYAGG(e.product_name),
                  'productRoles', ( -- Similar logic for productRoles within clientsData
                    SELECT
                      JSON_OBJECTAGG(
                        pr.product_role_name,
                        JSON_ARRAYAGG(da.data_asset_view_name)
                      )
                    FROM user_entitlement ue
                    LEFT JOIN product_role pr ON ue.product_role_id = pr.product_role_id
                    LEFT JOIN data_asset da ON pr.product_role_id = da.product_role_id
                    WHERE ue.user_id = :userId AND ucm.company_id = c.company_id
                  )
                )
              )
            FROM user_company_mapping ucm
            LEFT JOIN company c ON ucm.company_id = c.company_id
            LEFT JOIN user_entitlement ue ON ucm.user_id = ue.user_id
            LEFT JOIN product e ON ue.product_id = e.product_id
            WHERE ucm.user_id = :userId
            GROUP BY c.client_id
          )
        ) AS cached_data
      FROM user u
      LEFT JOIN user_company_mapping ucm ON u.user_id = ucm.user_id
      LEFT JOIN company c ON ucm.company_id = c.company_id
      LEFT JOIN user_entitlement ue ON u.user_id = ue.user_id
      LEFT JOIN product e ON ue.product_id = e.product_id
      WHERE u.user_id = :userId
    `;

    const result = await this.createQueryBuilder()
      .select('cached_data')
      .from('(' + query + ')', 'result')
      .setParameter('userId', userId)
      .getRawOne();

    return result.cached_data;
