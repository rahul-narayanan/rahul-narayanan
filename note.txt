const query = `
      SELECT
        (
          SELECT
            client_id,
            client_name,
            is_company_admin
          FROM user_company_mapping ucm
          LEFT JOIN company c ON ucm.company_id = c.company_id
          WHERE ucm.user_id = u.user_id
          FOR JSON AUTO
        ) AS clientsList,
        (
          SELECT
            product_name
          FROM user_entitlement ue
          LEFT JOIN product e ON ue.product_id = e.product_id
          WHERE ue.user_id = u.user_id
          FOR JSON AUTO
        ) AS products,
        (
          SELECT
            pr.product_role_name,
            (
              SELECT
                da.data_asset_view_name
              FROM user_entitlement ue
              LEFT JOIN product_role pr ON ue.product_role_id = pr.product_role_id
              LEFT JOIN data_asset da ON pr.product_role_id = da.product_role_id
              WHERE ue.user_id = u.user_id AND pr.product_role_id = pr_outer.product_role_id
              FOR JSON AUTO
            ) AS data_assets
          FROM user_entitlement ue_outer
          LEFT JOIN product_role pr_outer ON ue_outer.product_role_id = pr_outer.product_role_id
          WHERE ue_outer.user_id = u.user_id
          GROUP BY pr_outer.product_role_id, pr_outer.product_role_name
          FOR JSON AUTO
        ) AS productRoles,
        (
          SELECT
            c.client_id,
            client_name,
            is_company_admin,
            (
              SELECT
                product_name,
                (
                  SELECT
                    da.data_asset_view_name
                  FROM user_entitlement ue
                  LEFT JOIN product_role pr ON ue.product_role_id = pr.product_role_id
                  LEFT JOIN data_asset da ON pr.product_role_id = da.product_role_id
                  WHERE ue.user_id = u.user_id AND ucm.company_id = c.company_id AND pr.product_role_id = pr_outer.product_role_id
                  FOR JSON AUTO
                ) AS data_assets
              FROM user_entitlement ue_outer
              LEFT JOIN product_role pr_outer ON ue_outer.product_role_id = pr_outer.product_role_id
              LEFT JOIN data_asset da_outer ON pr_outer.product_role_id = da_outer.product_role_id
              WHERE ue_outer.user_id = u.user_id AND ucm.company_id = c.company_id
              GROUP BY pr_outer.product_role_id, pr_outer.product_role_name, da_outer.data_asset_view_name
              FOR JSON AUTO
            ) AS productRoles
          FROM user_company_mapping ucm
          LEFT JOIN company c ON ucm.company_id = c.company_id
          LEFT JOIN user_entitlement ue ON ucm.user_id = ue.user_id
          LEFT JOIN product e ON ue.product_id = e.product_id
          WHERE ucm.user_id = u.user_id
          GROUP BY c.client_id, client_name, is_company_admin
          FOR JSON AUTO
        ) AS clientsData
      FROM user u
      WHERE u.user_email = :userEmail
      FOR JSON PATH
    `;
