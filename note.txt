SELECT
    pr.product_role_name AS product_role,
    JSON_QUERY(
        '[' + STRING_AGG('"' + up.data_asset_view_name + '"', ',') + ']'
    ) AS data_asset_names
FROM
    UserPayload up
JOIN
    product_role pr ON pr.product_role_name = up.product_role_name
WHERE
    up.user_email = 'your_user_email_here'
GROUP BY
    pr.product_role_name;


SELECT
    user_email,
    client_id,
    client_name,
    is_company_admin,
    product_name,
    product_role_name,
    data_asset_view_name,
    NULL AS group_name,
    NULL AS account_number,
    NULL AS fund_code
FROM
    [user] u
JOIN
    [user_company_mapping] ucm ON ucm.userUserId = u.user_id
JOIN
    [company] c ON c.company_id = ucm.companyCompanyId
JOIN
    [user_entitlement] ue ON ue.user_id = u.user_id
JOIN
    [entitlement_group] eg ON eg.entitlement_group_id = ue.entitlement_group_id
JOIN
    [product_role] pr ON pr.product_role_id = eg.product_role_id
JOIN
    [product] p ON p.product_id = pr.product_id
LEFT JOIN
    [data_asset] da ON da.product_role_id = pr.product_role_id
UNION
SELECT
    user_email,
    client_id,
    client_name,
    is_company_admin,
    NULL AS product_name,
    NULL AS product_role_name,
    NULL AS data_asset_view_name,
    group_name,
    account_number,
    NULL AS fund_code
FROM
    [user] u
JOIN
    [user_company_mapping] ucm ON ucm.userUserId = u.user_id
JOIN
    [company] c ON c.company_id = ucm.companyCompanyId
JOIN
    [user_group_mapping] ugm ON ugm.userUserId = u.user_id
JOIN
    [group] g ON g.group_id = ugm.groupGroupId
JOIN
    [group_account_type_mapping] gam ON gam.groupId = ugm.groupGroupId
JOIN
    [account] a ON a.account_number = gam.accountNumber
UNION
SELECT
    user_email,
    client_id,
    client_name,
    is_company_admin,
    NULL AS product_name,
    NULL AS product_role_name,
    NULL AS data_asset_view_name,
    group_name,
    NULL AS account_number,
    fund_code
FROM
    [user] u
JOIN
    [user_company_mapping] ucm ON ucm.userUserId = u.user_id
JOIN
    [company] c ON c.company_id = ucm.companyCompanyId
JOIN
    [user_group_mapping] ugm ON ugm.userUserId = u.user_id
JOIN
    [group] g ON g.group_id = ugm.groupGroupId
JOIN
    [group_fund_type_mapping] gfm ON gfm.groupId = ugm.groupGroupId
JOIN
    [fund] f ON f.fund_id = gfm.fundId;
